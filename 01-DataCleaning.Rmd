#Markdown Notes

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(lme4)
library(lmerTest)
library(gridExtra)
library(corrplot)
library(GGally)
library(kableExtra)
```

```{r}
load("36806-0001-Data.rda")
ChicagoForeignCouncilRaw<-as.data.frame(da36806.0001)
#This will just allow use to reform this data in a more helpful way, so that we don't need to worry about it.

#Now We will need to clean the data. We will start off by removing the variables that are not useful to us. 


ChicagoForeignCouncilRaw2<-ChicagoForeignCouncilRaw %>%
  select(CASEID, XPHISPAN, DOV_Q8_14,PPAGE,PPEDUC,PPEDUCAT,PPETHM,PPGENDER,PPHHHEAD,PPHHSIZE,PPHOUSE,PPINCIMP,PPMARIT,PPMSACAT,PPREG4,PPREG9,PPRENT,PPSTATEN,PPWORK,PPNET,Q8_14,Q385,Q275)

ChicagoForeignCouncilRaw2<-ChicagoForeignCouncilRaw2[complete.cases(ChicagoForeignCouncilRaw2),]

#OTHER INTERESTING VARIABLES: ORLANDO, USR, MSC, CBSAMET

#Insert Here what data might be appropriate: 
# CASEID, XPHISPAN, ORLANDO, USR, MSC, CBSAMET, DOV_Q8_14,PPAGE,PPEDUC,PPETHM,PPGENDER,PPHHHEAD,PPHHSIZE,PPHOUSE,PPINCIMP,PPMARIT,PPMSACAT,PPREG4,PPREG9,PPRENT,PPSTATEN,PPWORK,PPNET,Q8_14,Q385,Q275

# I MIGHT CONSIDER Q278 and the associated questions important for figuring this shit out. 
summary(ChicagoForeignCouncilRaw2)
ChicagoForeignCouncilClean<-ChicagoForeignCouncilRaw2 %>%
  mutate(HISPANIC=ifelse(XPHISPAN=="(1) No, I am not",0,1),
         MALE=ifelse(PPGENDER=="(1) Male",1,0),
         IsHouseholdHead=ifelse(PPHHHEAD=="(0) NO",0,1),
         State=substring(PPSTATEN,5),
         Region4=substring(PPREG4,4),
         Region9=substring(PPREG9,4),
         StatementNumber=substring(DOV_Q8_14,2,2),
         InterventionSet1=substring(Q8_14,2,2)) %>%
    mutate(ProWarBinary=ifelse(InterventionSet1>2,0,1)) %>%
    mutate(AgeBracket=ifelse(PPAGE<=24,"18-24",
                       ifelse(PPAGE<=34,"25-34",
                       ifelse(PPAGE<=44,"35-44",
                       ifelse(PPAGE<=64,"45-64","65+"))))) %>%
    mutate(EducationNumber=as.integer(substring(PPEDUC,2,3))) %>%
    mutate(EducationBracket=ifelse(EducationNumber<5,"1.Less Than Ninth Grade",
                             ifelse(EducationNumber<=8,"2.High School, No Diploma",
                             ifelse(EducationNumber==9,"3.High School Graduate",
                             ifelse(EducationNumber==10,"4.Some College, No Degree",
                             ifelse(EducationNumber==11,"5. Associate's Degree",
                             ifelse(EducationNumber==12, "6.Bachelor's Degree","7.Graduate Degree")))))),
           EducationBracket2=ifelse(EducationNumber<=8, "1. No High School Diploma",
                             ifelse(EducationNumber==9,"2. High School Graduate",
                              ifelse(EducationNumber==10,"3.Some College, No Degree",
                             ifelse(EducationNumber==11,"4. Associate's Degree",
                             ifelse(EducationNumber==12, "5.Bachelor's Degree","6.Graduate Degree")))))) %>%
  
  select(-XPHISPAN,-PPGENDER,-PPHHHEAD,-PPSTATEN,-PPREG4,-PPREG9,-EducationNumber,-PPAGE,)

summary(factor(ChicagoForeignCouncilClean$StatementNumber))

summary(factor(ChicagoForeignCouncilClean$PPINCIMP))

summary(factor(ChicagoForeignCouncilClean$PPEDUC))

# I made preference towards intervention a binary variable. I chose to make Very Effective and Somewhat Effective variables that might suggest these people would be "open" to war. However, those who answer Not very, or Not effective at all are extremely unlikely to support war. 

# I should also consider how I might want to adjust the variable that shows household income. There is a chance that it is over-strata-d. This would be a problem. 
```

```{r}
ggplot(ChicagoForeignCouncilClean,aes(x=StatementNumber,fill=InterventionSet1))+geom_bar(position=position_fill())
#This is a graph meant to see if the order that the statement is shown in might be important to determining the preferences or the stated ideals that an individual has
```
By observing this data, we can see that there is no apparent distinction that exists between opinions of war, and whether or not this determine the factors that might lead to war.

```{r}
ggplot(ChicagoForeignCouncilClean,aes(x=Region4,fill=InterventionSet1))+geom_bar(position=position_fill())
#This plot will attempt to analyze whether there is a preference for war by region, such as region 4, or region 9, or state perhaps even. We can see that there does appear to be some slight preference, particularly in the south and in the Midwest. 
ggplot(ChicagoForeignCouncilClean,aes(x=Region9,fill=InterventionSet1))+geom_bar(position=position_fill())+theme(axis.text.x=element_text(angle=90))

```


```{r}
#Introductory Models
#M0<-glmer(data=ChicagoForeignCouncilClean,ProWarBinary~1+(1|State),family=binomial(link="logit"))
#summary(M0)
#M1<-glmer(data=ChicagoForeignCouncilClean,ProWarBinary~MALE+HISPANIC+(1|State),family=binomial(link="logit"))
#summary(M1)
#M2<-glmer(data = ChicagoForeignCouncilClean,ProWarBinary~MALE+HISPANIC+PPAGE+(1|State),family=binomial(link="logit"))
#summary(M2)
#M3<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(PPEDUCAT)+(1|State),family=binomial(link="logit"))
#summary(M3)
#After working with all of these variables, one remarkably thing that I have seen is that it appears like relatively limited amount of this is determined by things such as education or gender. 
#M4<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(PPEDUCAT)+MALE+(1|State),family=binomial(link="logit"))
#summary(M4)
#M5<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(PPEDUCAT)+MALE+(1|Region9),family=binomial(link="logit"))
#summary(M5)

#M6<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(PPEDUCAT)+MALE+factor(PPETHM)+(1|State),family=binomial(link="logit"))
#summary(M6)

#M7<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(PPEDUCAT)+MALE+factor(PPETHM)+factor(PPINCIMP)+(1|State),family=binomial(link="logit"))
#summary(M7)

#M7<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(PPEDUCAT)+factor(PPETHM)+factor(PPINCIMP)+(1|State),family=binomial(link="logit"))
#summary(M7)

#M8<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE+factor(PPEDUCAT)+factor(AgeBracket)+(1|State),family=binomial(link="logit"))
#summary(M8)

#M9<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~factor(AgeBracket)+factor(PPETHM)+factor(PPINCIMP)+(1|State),family=binomial(link="logit"))
#summary(M9)

#M10<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE*factor(AgeBracket)+factor(PPEDUCAT)+(1|State),family=binomial(link="logit"))
#summary(M10)

#M11<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE*factor(PPEDUCAT)+factor(AgeBracket)+(1|State),family=binomial(link="logit"))
#summary(M11)

#M12<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~Region9*MALE+factor(PPEDUCAT)+factor(AgeBracket)+(1|State),family=binomial(link="logit"))
#summary(M12)

#M13<-glm(data=ChicagoForeignCouncilClean,ProWarBinary~State,family=binomial(link="logit"))
#summary(M13)

#M14<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE+factor(PPEDUCAT)+factor(AgeBracket)*Region4+(1|State),family=binomial(link="logit"))
#summary(M14)

#M15<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE+factor(EducationBracket)+factor(AgeBracket)+(1|State),family=binomial(link="logit"))
#summary(M15)

M16<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE+factor(EducationBracket2)+factor(AgeBracket)+(1|State),family=binomial(link="logit"))
summary(M16)


#M17<-glmer(data= ChicagoForeignCouncilClean,ProWarBinary~MALE+factor(EducationBracket2)+factor(AgeBracket)+(1|Region9),family=binomial(link="logit"))
#summary(M17)

#Up to this point, I've found that Education Level, broken into Strata, and Age Brackets seems to be a good predictor. I've elected to choose to move forward with a model if it is supported by the ACS. In addition, I have decided to move forward with a model if it is 
```
I feel like Model 16 works the best of anything that I have seen so far. Therefore, we are able to find a lot of different variables, and what their expected values are. In addition, we can observe some of the effects in r of each random effect. 

```{r}
FullCoefficientsList<-coef(M16)$State
FullCoefficientsList
StateRandomEffects<-FullCoefficientsList[,0:1]
#This Will allow us to understand what variable is the most important for this

# Background says that Men tend to be more pro-war, 
# Background says that higher levels of education tend to 
# 
```

```{r}
#One important thing to notice is the intercepts don't change. Therefore, we should be able to define each of these variables. Unfortunately, there are a lot of Different Variables

CMale<-M16@beta[2]
CHSGrad<-M16@beta[3]
CSomeCollege<-M16@beta[4]
CAssociates<-M16@beta[5]
CBachelor<-M16@beta[6]
CGraduate<-M16@beta[7]
C25_34<-M16@beta[8]
C35_44<-M16@beta[9]
C45_64<-M16@beta[10]
C65Plus<-M16@beta[11]



#The Code MODEL@beta[i] can find the i'th intercept of our Model. 

#for (i in 1:nrow(FullCoefficientsList)) {
    
#}


```

```{r}
library(rstanarm)

fit<-stan_glmer(data=ChicagoForeignCouncilClean,ProWarBinary~MALE+factor(EducationBracket2)+factor(AgeBracket)+(1|State),family=binomial(link="logit"))
```
```{r}
summary(fit)
```

